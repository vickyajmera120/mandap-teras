# Mandap Billing System - Project Context

This file serves as a comprehensive reference for the Mandap Billing System project, detailing the architecture, technology stack, and operational procedures.

## ðŸš€ Project Overview
A specialized billing and inventory rental management system designed for **Fagun Sud 13 Mandap Contractor**, featuring a modern UI and a robust Spring Boot backend.

> **Important**: This software manages rentals for a **single annual event** (Fagun Sud 13). Each customer has **one rental order** and **one bill** per event cycle.

---

## ðŸ› ï¸ Technology Stack

### **Backend**
- **Core**: Java 17, Spring Boot 3.2.3
- **Security**: Spring Security, JWT (jjwt 0.12.5)
- **Database**: MySQL 8 (using Spring Data JPA)
- **Build Tool**: Maven
- **Utilities**: Lombok, Validation Starter

### **Frontend (mandap-ui)**
- **Framework**: Angular 21 (Latest)
- **Styling**: Tailwind CSS 4, DaisyUI 5
- **Icons**: FontAwesome 6/7
- **State/Logic**: RxJS, Reactive Forms, Signals
- **UI Components**: ng-select, Toastr
- **Design System**: Glassmorphism, Dark Mode Support

---

## ðŸ“‚ Project Structure

### **Root Directory**
- `src/`: Java backend source code.
- `mandap-ui/`: Angular frontend application.
- `pom.xml`: Maven configuration.
- `SETUP.md`: Deployment and setup guide.
- `README.md`: General project overview.

### **Backend Details (`src/main/java/com/mandap/`)**
- `config/`: Security and data initialization.
- `controller/`: REST API endpoints.
- `dto/`: Data Transfer Objects for API requests/responses.
- `entity/`: JPA entities (Bill, Payment, RentalOrder, InventoryItem, etc.).
- `repository/`: Data access layer (Spring Data JPA).
- `security/`: JWT filtering and authentication logic.
- `service/`: Business logic layer.

### **Frontend Details (`mandap-ui/src/app/`)**
- `core/`: Services, models, and guards used across the app.
- `features/`: Module-based feature components:
    - `billing/`: Bill creation, history, print views.
    - `rental-orders/`: Booking, dispatch, return logic.
    - `inventory/`: Stock management, tracking.
    - `customers/`: Customer directory.
    - `dashboard/`: Overview metrics.
- `shared/`: Reusable components (Modal, Sidebar, Loading Spinner, Toasts).
- `layouts/`: Main layout structures.

---

## âš™ï¸ Development & Operations

### **Starting the Servers**

#### **Backend**
```powershell
# From the root directory
mvn spring-boot:run
```
- **Port**: 8080 (Default)
- **Profiles**: Configured via `application.properties`.

#### **Frontend**
```powershell
# From the mandap-ui directory
npm install
npm run start # Runs 'ng serve'
```
- **Port**: 4200 (Default)
- **Proxy**: Configured in `proxy.conf.json` to route `/api` calls to the backend (localhost:8080).

### **Deployment**

#### **Backend**
- Package into an executable JAR: `mvn clean package`.
- Run using: `java -jar target/mandap-billing-1.0.0.jar`.

#### **Frontend**
- Build for production: `npm run build`.
- Artifacts are generated in `mandap-ui/dist/`.
- Can be served via Nginx or integrated into the Spring Boot `static/` folder (requires copying to `src/main/resources/static`).

---

## âœ¨ Core Functionalities

### 1. **Authentication & Roles**
- Secure login with JWT.
- Roles: **ADMIN** (Full access), **MANAGER** (Limited admin), **BILLING_CLERK** (Billing/Rental ops), **VIEWER** (Read-only).
- Customizable permissions per role.

### 2. **Inventory Management**
- **Stock Tracking**: Real-time `Total`, `Available`, `Booked`, `Dispatched` counts.
- **Usage Tracking**: "Where is my stock?" view to see which customers hold specific items.
- **Bilingual Support**: Items have English and Gujarati names.
- **Categories**: Left/right split organization for easy checklist usage.

### 3. **Rental Order Lifecycle**
- **One Order Per Customer**: Enforced rule.
- **Status Flow**: `BOOKED` -> `DISPATCHED` -> `PARTIALLY_RETURNED` -> `RETURNED`.
- **Pal Numbers**: Digital tracking of physical Pal numbers (crate/bag IDs).
- **Printing**: Delivery Challan printouts.

### 4. **Billing System**
- **Integration**: One-click generation from Rental Order (pulls unreturned/booked items).
- **Deposit Handling**: 
    - Treated as an explicit "Initial Deposit" Payment record.
    - Fields: Amount, Method (Cash/Cheque/Online), Cheque/Ref No.
- **Payments**: 
    - Supports Partial and Full payments.
    - Detailed Payment History tracking.
    - Balance (Net Payable) auto-calculation.
- **Printing**: 
    - Professional Gujarati layout.
    - Detailed Item table.
    - Summary includes "Total Amount", "Total Payment", and "Net Payable".

### 5. **Customer Management**
- Centralized customer database.
- Tracks history across orders and bills.
- Duplicate detection capabilities.

### 6. **UI/UX**
- **Theme Switching**: Dark/Light mode toggle.
- **Glassmorphism**: Modern, translucent UI components.
- **Responsive**: Adapts to different screen sizes (though optimized for desktop).

---

## ðŸ”‘ Business Rules

| Rule | Description |
|------|-------------|
| **One Order Per Customer** | Each customer can have only one active rental order per event cycle. |
| **One Bill Per Customer** | Each customer can have only one final bill. |
| **Stock Validation** | System prevents booking/dispatching more items than physically available in stock. |
| **Deposit Persistence** | Deposits entered during Bill creation are immediately recorded as Payments. |
| **Non-Destructive Edits** | Editing a bill creates a revision or updates the existing record carefully without losing payment history. |

---

## ðŸ“ Ongoing Context & Rules
- **Formatting**: Maintain Prettier/PostCSS standards in the UI.
- **API Styling**: Follow RESTful principles for backend controllers.
- **UI Design**: Prioritize glassmorphism and modern aesthetics.
- **Database**: Ensure `CascadeType.ALL` is respected for parent-child relationships (e.g., Bill -> Payments) to avoid orphan records.
